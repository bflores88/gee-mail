<html>

<head>
	<script src="js/mail-generator.js"></script>
	<link href="css/style.css" rel="stylesheet" media="screen">
	<link rel="icon" href="assets/favicon.ico">
	<title>Gee-mail!</title>
	<link href="https://fonts.googleapis.com/css?family=Fahkwang|Quicksand" rel="stylesheet">
	<script>
		window.onload = function () {
			// ALL OF YOUR JAVASCRIPT CODE SHOULD GO HERE. 
			// We have to use window.onload so your JavaScript doesn't execute until the page has loaded and all HTML has been downloaded to your browser

			//Declare variable for mails

			var mailArray = window.geemails
			var newMailArray = mailArray;

			//content for sidecounter
			var totalMessages = 0;
			totalMessages = newMailArray.length;

			ttlmess.innerHTML = totalMessages
			// read.innerHTML = 0;
			// unread.innerHTML = totalMessages - read.innerHTML;


			//Set interval for mail to add
			setInterval(addMessage, 5000);

			function addMessage() {
				var newMessage = getNewMessage();
				newMailArray.push(newMessage);

				var messageBox = document.createElement('div');
				messageBox.className = 'messages';
				main.prepend(messageBox);

				var fromDate = document.createElement('div');
				fromDate.className = 'fromDate';
				messageBox.appendChild(fromDate);

				var mailFrom = document.createElement('div');
				mailFrom.className = 'sender';
				mailFrom.innerHTML = 'From: ' + newMessage.sender;
				fromDate.appendChild(mailFrom);

				var mailDate = document.createElement('div');
				mailDate.className = 'date';
				mailDate.innerHTML = newMessage.date;
				fromDate.appendChild(mailDate);

				var mailSubject = document.createElement('div');
				mailSubject.className = 'subject';
				mailSubject.innerHTML = 'Subject: ' + newMessage.subject;
				messageBox.appendChild(mailSubject);

				var mailBody = document.createElement('div');
				mailBody.className = 'mailBody';
				mailBody.innerHTML = newMessage.body;
				mailSubject.appendChild(mailBody);

				var messageArray = document.getElementsByClassName('messages');

				for (var i = 0; i < messageArray.length; i++) {
					messageArray[i].addEventListener('click', showMessage);
				}

				function showMessage() {

					var showMess = this.querySelectorAll('.mailBody')[0];
					if (showMess.style.display === 'none') {
						showMess.style.display = 'block';
						this.style.fontWeight = 'normal';
					} else {
						showMess.style.display = 'none';
					}

				}



				//Content for sidecount container
				totalMessages = newMailArray.length;
				ttlmess.innerHTML = totalMessages;
				// unread.innerHTML = totalMessages - read.innerHTML;

			}

			//Sort the contents in the mail array by date from newest to oldest because why not cuz
			newMailArray.sort(function (a, b) {
				var dateA = (a.date),
					dateB = (b.date);
				return dateA - dateB;
			});

			//For loop to consume data and such
			for (var i = 0; i < newMailArray.length; i++) {

				var messageBox = document.createElement('div');
				messageBox.className = 'messages';
				main.appendChild(messageBox);

				var fromDate = document.createElement('div');
				fromDate.className = 'fromDate';
				messageBox.appendChild(fromDate);

				var mailFrom = document.createElement('div');
				mailFrom.className = 'sender';
				mailFrom.innerHTML = 'From: ' + newMailArray[i].sender;
				fromDate.appendChild(mailFrom);

				var mailDate = document.createElement('div');
				mailDate.className = 'date';
				mailDate.innerHTML = newMailArray[i].date;
				fromDate.appendChild(mailDate);

				var mailSubject = document.createElement('div');
				mailSubject.className = 'subject';
				mailSubject.innerHTML = 'Subject: ' + newMailArray[i].subject;
				messageBox.appendChild(mailSubject);

				var mailBody = document.createElement('div');
				mailBody.className = 'mailBody';
				mailBody.innerHTML = newMailArray[i].body;
				mailSubject.appendChild(mailBody);

			}

			//Adds event listener to the messages box that will show the message content upon clicking.
			var subjectArray = document.getElementsByClassName('messages');

			for (var i = 0; i < subjectArray.length; i++) {
				subjectArray[i].addEventListener('click', showMessage);
			}

			function showMessage() {

				var showMess = this.querySelectorAll('.mailBody')[0];
				if (showMess.style.display === 'none') {
					showMess.style.display = 'block';
					this.style.fontWeight = 'normal';
				} else {
					showMess.style.display = 'none';
				}

			}

			console.log(newMailArray);

		};
	</script>
</head>

<body>
	<header id="header">
		<h1 id='geeMail'>Gee-mail</h1>
	</header>

	<div class="container" id="maincontainer">

		<div class="container" id="sidecount">
			<h2 id="inboxttl">INBOX</h2>

			<div class="statbox">
				<p class="status">Total Messages</p>
				<p class="statcount" id="ttlmess"></p>
			</div>

			<div class="countstat">
				<p class="status">Unread</p>
				<p class="statcount" id="unread"></p>
			</div>

			<div class="countstat">
				<p class="status">Read</p>
				<p class="statcountRead" id="read"></p>
			</div>


		</div>

		<div class="container" id="main"></div>

	</div>
</body>

</html>